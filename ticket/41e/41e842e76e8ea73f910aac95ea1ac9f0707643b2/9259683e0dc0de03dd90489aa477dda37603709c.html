<?xml version="1.0"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>Twisted Documentation: Creating XML-RPC Servers and Clients with Twisted</title><link href="web2_oubiwann/howto/../core/documentation/howto/stylesheet.css" type="text/css" rel="stylesheet" /></head><body bgcolor="white"><h1 class="title">Creating XML-RPC Servers and Clients with Twisted</h1><div class="toc"><ol><li><a href="#auto0">Introduction</a></li><li><a href="#auto1">Creating a XML-RPC server</a></li><ul><li><a href="#auto2">Using XML-RPC sub-handlers</a></li><li><a href="#auto3">Adding XML-RPC Introspection support</a></li></ul><li><a href="#auto4">SOAP Support</a></li><li><a href="#auto5">Creating an XML-RPC Client</a></li><li><a href="#auto6">XML-RPC and Authentication</a></li><li><a href="#auto7">Migrating twisted.web XML-RPC to twisted.web2</a></li><ul><li><a href="#auto8">Add addSlash</a></li><li><a href="#auto9">Add request to the Method Signatures</a></li><li><a href="#auto10">Wrap the Site Object</a></li></ul></ol></div><div class="content"><span></span><h2>Introduction<a name="auto0"></a></h2><p><a href="http://www.xmlrpc.com">XML-RPC</a> is a simple request/reply protocol that runs over HTTP. It is simple,
easy to implement and supported by most programming languages. Twisted's XML-RPC
support is implemented using the xmlrpclib library that is included with Python 2.2 and later.</p><p>This document assumes some familiarity with cred and suggests you read the
<a href="http://twistedmatrix.com/projects/web2/documentation/howto">twisted.web2
howtos</a> as well as 
<a href="http://twistedmatrix.com/projects/core/documentation/howto/application.html">Using
the Twisted Application Framework</a></p><h2>Creating a XML-RPC server<a name="auto1"></a></h2><p>Making a server is very easy - all you need to do is inherit from <code class="API"><a href="http://twistedmatrix.com/documents/current/api/twisted.web2.xmlrpc.XMLRPC.html" title="twisted.web2.xmlrpc.XMLRPC">twisted.web2.xmlrpc.XMLRPC</a></code>.
You then create methods beginning with <code>xmlrpc_</code>. The methods'
arguments determine what arguments it will accept from XML-RPC clients.
The result is what will be returned to the clients.</p><p>Methods published via XML-RPC can return all the basic XML-RPC
types, such as strings, lists and so on (just return a regular python
integer, etc).  They can also return Failure instances to indicate an
error has occurred, or <code class="API"><a href="http://twistedmatrix.com/documents/current/api/twisted.web.xmlrpc.Binary.html" title="twisted.web.xmlrpc.Binary">Binary</a></code>, <code class="API"><a href="http://twistedmatrix.com/documents/current/api/twisted.web.xmlrpc.Boolean.html" title="twisted.web.xmlrpc.Boolean">Boolean</a></code> or <code class="API"><a href="http://twistedmatrix.com/documents/current/api/twisted.web.xmlrpc.DateTime.html" title="twisted.web.xmlrpc.DateTime">DateTime</a></code> instances (all of these are the same as
the respective classes in xmlrpclib. In addition, XML-RPC published
methods can return <code class="API"><a href="http://twistedmatrix.com/documents/current/api/twisted.internet.defer.Deferred.html" title="twisted.internet.defer.Deferred">Deferred</a></code> instances whose results are one of the
above. This allows you to return results that can't be calculated
immediately, such as database queries. See the <a href="defer.html">Deferred documentation</a> for more details.</p><p><code class="API"><a href="http://twistedmatrix.com/documents/current/api/twisted.web.xmlrpc.XMLRPC.html" title="twisted.web.xmlrpc.XMLRPC">XMLRPC</a></code> instances
are Resource objects, and they can thus be published using a Site. The
following example has two methods published via XML-RPC, <code>add(a,
b)</code> and <code>echo(x)</code>.</p><div class="py-listing"><pre>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">xmlrpc</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">server</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">channel</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">application</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">service</span>, <span class="py-src-variable">strports</span>

<span class="py-src-keyword">class</span> <span class="py-src-identifier">Example</span>(<span class="py-src-parameter">xmlrpc</span>.<span class="py-src-parameter">XMLRPC</span>):
    <span class="py-src-string">&quot;&quot;&quot;An example object to be published.&quot;&quot;&quot;</span>

    <span class="py-src-variable">addSlash</span> = <span class="py-src-variable">True</span>

    <span class="py-src-keyword">def</span> <span class="py-src-identifier">xmlrpc_echo</span>(<span class="py-src-parameter">self</span>, <span class="py-src-parameter">request</span>, <span class="py-src-parameter">x</span>):
        <span class="py-src-string">&quot;&quot;&quot;Return all passed args.&quot;&quot;&quot;</span>
        <span class="py-src-keyword">return</span> <span class="py-src-variable">x</span>

    <span class="py-src-keyword">def</span> <span class="py-src-identifier">xmlrpc_add</span>(<span class="py-src-parameter">self</span>, <span class="py-src-parameter">request</span>, <span class="py-src-parameter">a</span>, <span class="py-src-parameter">b</span>):
        <span class="py-src-string">&quot;&quot;&quot;Return sum of arguments.&quot;&quot;&quot;</span>
        <span class="py-src-keyword">return</span> <span class="py-src-variable">a</span> + <span class="py-src-variable">b</span>

<span class="py-src-keyword">if</span> <span class="py-src-variable">__name__</span> == <span class="py-src-string">'__main__'</span>:
    <span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">internet</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">reactor</span>
    <span class="py-src-variable">site</span> = <span class="py-src-variable">server</span>.<span class="py-src-variable">Site</span>(<span class="py-src-variable">Example</span>())
    <span class="py-src-variable">reactor</span>.<span class="py-src-variable">listenTCP</span>(<span class="py-src-number">7080</span>, <span class="py-src-variable">channel</span>.<span class="py-src-variable">HTTPFactory</span>(<span class="py-src-variable">site</span>))
    <span class="py-src-variable">reactor</span>.<span class="py-src-variable">run</span>()
</pre><div class="caption">Source listing - <a href="../examples/xmlrpc/example1.py"><span class="filename">../examples/xmlrpc/example1.py</span></a></div></div><p>We could run example1.py in the background like so, 
<code>python example1.py &amp;</code> and then connect with client code in the
following manner:</p><pre class="python-interpreter">
&gt;&gt;&gt; import xmlrpclib
&gt;&gt;&gt; s = xmlrpclib.Server('http://localhost:7080/')
&gt;&gt;&gt; s.echo('A self-perpetuating autocracy in which the working class...')
'A self-perpetuating autocracy in which the working class...'
&gt;&gt;&gt; s.add(1, 2)
3
</pre><p>If you are coming from <code class="API"><a href="http://twistedmatrix.com/documents/current/api/twisted.web.xmlrpc.html" title="twisted.web.xmlrpc">twisted.web.xmlrpc</a></code>, then you probably noticed two differences: the use of <code>addSlash</code> and that <code>request</code> appears in the signature for methods.</p><p>To run this example as a twisted application, save the following as
<code>example1.tac</code>:</p><div class="py-listing"><pre>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">xmlrpc</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">server</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">channel</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">application</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">service</span>, <span class="py-src-variable">strports</span>

<span class="py-src-keyword">class</span> <span class="py-src-identifier">Example</span>(<span class="py-src-parameter">xmlrpc</span>.<span class="py-src-parameter">XMLRPC</span>):
    <span class="py-src-string">&quot;&quot;&quot;An example object to be published.&quot;&quot;&quot;</span>

    <span class="py-src-variable">addSlash</span> = <span class="py-src-variable">True</span>

    <span class="py-src-keyword">def</span> <span class="py-src-identifier">xmlrpc_echo</span>(<span class="py-src-parameter">self</span>, <span class="py-src-parameter">request</span>, <span class="py-src-parameter">x</span>):
        <span class="py-src-string">&quot;&quot;&quot;Return all passed args.&quot;&quot;&quot;</span>
        <span class="py-src-keyword">return</span> <span class="py-src-variable">x</span>

    <span class="py-src-keyword">def</span> <span class="py-src-identifier">xmlrpc_add</span>(<span class="py-src-parameter">self</span>, <span class="py-src-parameter">request</span>, <span class="py-src-parameter">a</span>, <span class="py-src-parameter">b</span>):
        <span class="py-src-string">&quot;&quot;&quot;Return sum of arguments.&quot;&quot;&quot;</span>
        <span class="py-src-keyword">return</span> <span class="py-src-variable">a</span> + <span class="py-src-variable">b</span>

<span class="py-src-variable">site</span> = <span class="py-src-variable">server</span>.<span class="py-src-variable">Site</span>(<span class="py-src-variable">Example</span>())
<span class="py-src-variable">application</span> = <span class="py-src-variable">service</span>.<span class="py-src-variable">Application</span>(<span class="py-src-string">&quot;Example XML-RPC Server&quot;</span>)
<span class="py-src-variable">s</span> = <span class="py-src-variable">strports</span>.<span class="py-src-variable">service</span>(<span class="py-src-string">'tcp:7080'</span>, <span class="py-src-variable">channel</span>.<span class="py-src-variable">HTTPFactory</span>(<span class="py-src-variable">site</span>))
<span class="py-src-variable">s</span>.<span class="py-src-variable">setServiceParent</span>(<span class="py-src-variable">application</span>)
</pre><div class="caption">Source listing - <a href="../examples/xmlrpc/example1.tac"><span class="filename">../examples/xmlrpc/example1.tac</span></a></div></div><p>Then execute with the command <code>twistd -noy example.tac</code>.</p><p>XML-RPC resources can be seamlessly integrated with other 
<code class="API"><a href="http://twistedmatrix.com/documents/current/api/twisted.web2.html" title="twisted.web2">twisted.web2</a></code> resources. Here is an example of a
web2 server running a simple HTTP resource as well as an XML-RPC resource:</p><div class="py-listing"><pre>
<span class="py-src-keyword">from</span> <span class="py-src-variable">random</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">choice</span>

<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">http</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">server</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">channel</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">resource</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">xmlrpc</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">application</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">service</span>, <span class="py-src-variable">strports</span>

<span class="py-src-keyword">def</span> <span class="py-src-identifier">getQuote</span>():
    <span class="py-src-variable">quotes</span> = [
        <span class="py-src-string">'The concept of progress acts as a protective mechanism '</span> +
            <span class="py-src-string">'to shield us from the terrors of the future.'</span>,
        <span class="py-src-string">'Truth suffers from too much analysis'</span>,
        <span class="py-src-string">'A process cannot be understood by stopping it.'</span>,
    ]
    <span class="py-src-keyword">return</span> <span class="py-src-variable">choice</span>(<span class="py-src-variable">quotes</span>)

<span class="py-src-keyword">class</span> <span class="py-src-identifier">Quoter</span>(<span class="py-src-parameter">xmlrpc</span>.<span class="py-src-parameter">XMLRPC</span>):

    <span class="py-src-keyword">def</span> <span class="py-src-identifier">xmlrpc_quote</span>(<span class="py-src-parameter">self</span>, <span class="py-src-parameter">request</span>):
        <span class="py-src-keyword">return</span> <span class="py-src-variable">getQuote</span>()

<span class="py-src-keyword">class</span> <span class="py-src-identifier">Toplevel</span>(<span class="py-src-parameter">resource</span>.<span class="py-src-parameter">Resource</span>):
  <span class="py-src-variable">addSlash</span> = <span class="py-src-variable">True</span>
  <span class="py-src-variable">child_RPC2</span> = <span class="py-src-variable">Quoter</span>()
  <span class="py-src-keyword">def</span> <span class="py-src-identifier">render</span>(<span class="py-src-parameter">self</span>, <span class="py-src-parameter">ctx</span>):
        <span class="py-src-keyword">return</span> <span class="py-src-variable">http</span>.<span class="py-src-variable">Response</span>(<span class="py-src-variable">stream</span>=<span class="py-src-string">&quot;Hello monkey!&quot;</span>)

<span class="py-src-variable">site</span> = <span class="py-src-variable">server</span>.<span class="py-src-variable">Site</span>(<span class="py-src-variable">Toplevel</span>())
<span class="py-src-variable">application</span> = <span class="py-src-variable">service</span>.<span class="py-src-variable">Application</span>(<span class="py-src-string">&quot;Quote Server+&quot;</span>)
<span class="py-src-variable">s</span> = <span class="py-src-variable">strports</span>.<span class="py-src-variable">service</span>(<span class="py-src-string">'tcp:8080'</span>, <span class="py-src-variable">channel</span>.<span class="py-src-variable">HTTPFactory</span>(<span class="py-src-variable">site</span>))
<span class="py-src-variable">s</span>.<span class="py-src-variable">setServiceParent</span>(<span class="py-src-variable">application</span>)
</pre><div class="caption">Source listing - <a href="../examples/xmlrpc/quote.tac"><span class="filename">../examples/xmlrpc/quote.tac</span></a></div></div><p>Not only can one browse to http://localhost:8080, but one can also access the
XML-RPC service available at http://localhost:8080/RPC2.</p><h3>Using XML-RPC sub-handlers<a name="auto2"></a></h3><p>XML-RPC resource can be nested so that one handler calls another if
a method with a given prefix is called. This can be a very convenient mechanism
for organizing RPC APIs. For example, we can add support for
an XML-RPC method <code>date.time()</code> to the
<code class="python">Example</code> class, and move the <code>add()</code>
method to <code>math.add()</code>:</p><div class="py-listing"><pre>
<span class="py-src-keyword">import</span> <span class="py-src-variable">time</span>

<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">server</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">channel</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">xmlrpc</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">application</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">service</span>, <span class="py-src-variable">strports</span>

<span class="py-src-keyword">class</span> <span class="py-src-identifier">Example</span>(<span class="py-src-parameter">xmlrpc</span>.<span class="py-src-parameter">XMLRPC</span>):

    <span class="py-src-variable">addSlash</span> = <span class="py-src-variable">True</span>

    <span class="py-src-string">&quot;&quot;&quot;An example object to be published.&quot;&quot;&quot;</span>
    <span class="py-src-keyword">def</span> <span class="py-src-identifier">xmlrpc_echo</span>(<span class="py-src-parameter">self</span>, <span class="py-src-parameter">request</span>, <span class="py-src-parameter">x</span>):
        <span class="py-src-string">&quot;&quot;&quot;Return all passed args.&quot;&quot;&quot;</span>
        <span class="py-src-keyword">return</span> <span class="py-src-variable">x</span>

<span class="py-src-keyword">class</span> <span class="py-src-identifier">Math</span>(<span class="py-src-parameter">xmlrpc</span>.<span class="py-src-parameter">XMLRPC</span>):
    <span class="py-src-string">&quot;&quot;&quot;Put our math methods here.&quot;&quot;&quot;</span>

    <span class="py-src-keyword">def</span> <span class="py-src-identifier">xmlrpc_add</span>(<span class="py-src-parameter">self</span>, <span class="py-src-parameter">request</span>, <span class="py-src-parameter">a</span>, <span class="py-src-parameter">b</span>):
        <span class="py-src-string">&quot;&quot;&quot;Return sum of arguments.&quot;&quot;&quot;</span>
        <span class="py-src-keyword">return</span> <span class="py-src-variable">a</span> + <span class="py-src-variable">b</span>

<span class="py-src-keyword">class</span> <span class="py-src-identifier">Date</span>(<span class="py-src-parameter">xmlrpc</span>.<span class="py-src-parameter">XMLRPC</span>):
    <span class="py-src-string">&quot;&quot;&quot;Put our date methods here.&quot;&quot;&quot;</span>

    <span class="py-src-keyword">def</span> <span class="py-src-identifier">xmlrpc_time</span>(<span class="py-src-parameter">self</span>, <span class="py-src-parameter">request</span>):
        <span class="py-src-string">&quot;&quot;&quot;Return UNIX time.&quot;&quot;&quot;</span>
        <span class="py-src-keyword">return</span> <span class="py-src-variable">time</span>.<span class="py-src-variable">time</span>()

<span class="py-src-variable">root</span> = <span class="py-src-variable">Example</span>()
<span class="py-src-variable">root</span>.<span class="py-src-variable">putSubHandler</span>(<span class="py-src-string">'math'</span>, <span class="py-src-variable">Math</span>())
<span class="py-src-variable">root</span>.<span class="py-src-variable">putSubHandler</span>(<span class="py-src-string">'date'</span>, <span class="py-src-variable">Date</span>())

<span class="py-src-variable">site</span> = <span class="py-src-variable">server</span>.<span class="py-src-variable">Site</span>(<span class="py-src-variable">root</span>)
<span class="py-src-variable">application</span> = <span class="py-src-variable">service</span>.<span class="py-src-variable">Application</span>(<span class="py-src-string">&quot;XML-RPC Server With Sub-handlers&quot;</span>)
<span class="py-src-variable">s</span> = <span class="py-src-variable">strports</span>.<span class="py-src-variable">service</span>(<span class="py-src-string">'tcp:8080'</span>, <span class="py-src-variable">channel</span>.<span class="py-src-variable">HTTPFactory</span>(<span class="py-src-variable">site</span>))
<span class="py-src-variable">s</span>.<span class="py-src-variable">setServiceParent</span>(<span class="py-src-variable">application</span>)
</pre><div class="caption">Source listing - <a href="../examples/xmlrpc/example2.tac"><span class="filename">../examples/xmlrpc/example2.tac</span></a></div></div><p>By default, a period ('.') separates the prefix from the method
name, but you can use a different character by overriding the <code class="python">XMLRPC.separator</code> data member in your base
XML-RPC server. XML-RPC servers may be nested to arbitrary depths
using this method.</p><p>Running client code from the python interpreter, we can see the subhandlers
in action:</p><pre class="python-interpreter">
&gt;&gt;&gt; import xmlrpclib
&gt;&gt;&gt; s = xmlrpclib.ServerProxy('http://127.0.0.1:8080/')
&gt;&gt;&gt; s.echo('Oh, there you go bringing class into it again.')
'Oh, there you go bringing class into it again.'
&gt;&gt;&gt; s.math.add(1,2)
3
&gt;&gt;&gt; s.date.time()
1151921139.9897649
</pre><h3>Adding XML-RPC Introspection support<a name="auto3"></a></h3><p>XML-RPC has an informal 
<a href="http://ldp.kernelnotes.de/HOWTO/XML-RPC-HOWTO/xmlrpc-howto-interfaces.html">Introspection API</a> 
that specifies three methods in a <code>system</code> sub-handler which allow a
client to query a server about the server's API. Adding Introspection support
to the <code class="python">Example</code> class is easy using the 
<code class="API"><a href="http://twistedmatrix.com/documents/current/api/twisted.web.xmlrpc.XMLRPCIntrospection.html" title="twisted.web.xmlrpc.XMLRPCIntrospection">XMLRPCIntrospection</a></code>
class:</p><div class="py-listing"><pre>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">server</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">channel</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">xmlrpc</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">application</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">service</span>, <span class="py-src-variable">strports</span>

<span class="py-src-keyword">class</span> <span class="py-src-identifier">Example</span>(<span class="py-src-parameter">xmlrpc</span>.<span class="py-src-parameter">XMLRPC</span>):
    <span class="py-src-string">&quot;&quot;&quot;An example object to be published.&quot;&quot;&quot;</span>

    <span class="py-src-variable">addSlash</span> = <span class="py-src-variable">True</span>

    <span class="py-src-keyword">def</span> <span class="py-src-identifier">xmlrpc_echo</span>(<span class="py-src-parameter">self</span>, <span class="py-src-parameter">request</span>, <span class="py-src-parameter">x</span>):
        <span class="py-src-string">&quot;&quot;&quot;Return all passed args.&quot;&quot;&quot;</span>
        <span class="py-src-keyword">return</span> <span class="py-src-variable">x</span>

    <span class="py-src-variable">xmlrpc_echo</span>.<span class="py-src-variable">signature</span> = [[<span class="py-src-string">'string'</span>, <span class="py-src-string">'string'</span>],
                             [<span class="py-src-string">'int'</span>, <span class="py-src-string">'int'</span>],
                             [<span class="py-src-string">'double'</span>, <span class="py-src-string">'double'</span>],
                             [<span class="py-src-string">'array'</span>, <span class="py-src-string">'array'</span>],
                             [<span class="py-src-string">'struct'</span>, <span class="py-src-string">'struct'</span>]]

    <span class="py-src-keyword">def</span> <span class="py-src-identifier">xmlrpc_add</span>(<span class="py-src-parameter">self</span>, <span class="py-src-parameter">request</span>, <span class="py-src-parameter">a</span>, <span class="py-src-parameter">b</span>):
        <span class="py-src-string">&quot;&quot;&quot;Return sum of arguments.&quot;&quot;&quot;</span>
        <span class="py-src-keyword">return</span> <span class="py-src-variable">a</span> + <span class="py-src-variable">b</span>

    <span class="py-src-variable">xmlrpc_add</span>.<span class="py-src-variable">signature</span> = [[<span class="py-src-string">'int'</span>, <span class="py-src-string">'int'</span>, <span class="py-src-string">'int'</span>],
                            [<span class="py-src-string">'double'</span>, <span class="py-src-string">'double'</span>, <span class="py-src-string">'double'</span>]]
    <span class="py-src-variable">xmlrpc_add</span>.<span class="py-src-variable">help</span> = <span class="py-src-string">&quot;Add the arguments and return the sum.&quot;</span>

<span class="py-src-variable">root</span> = <span class="py-src-variable">Example</span>()
<span class="py-src-variable">xmlrpc</span>.<span class="py-src-variable">addIntrospection</span>(<span class="py-src-variable">root</span>)

<span class="py-src-variable">site</span> = <span class="py-src-variable">server</span>.<span class="py-src-variable">Site</span>(<span class="py-src-variable">root</span>)
<span class="py-src-variable">application</span> = <span class="py-src-variable">service</span>.<span class="py-src-variable">Application</span>(<span class="py-src-string">&quot;XML-RPC Server With Sub-handlers&quot;</span>)
<span class="py-src-variable">s</span> = <span class="py-src-variable">strports</span>.<span class="py-src-variable">service</span>(<span class="py-src-string">'tcp:8080'</span>, <span class="py-src-variable">channel</span>.<span class="py-src-variable">HTTPFactory</span>(<span class="py-src-variable">site</span>))
<span class="py-src-variable">s</span>.<span class="py-src-variable">setServiceParent</span>(<span class="py-src-variable">application</span>)
</pre><div class="caption">Source listing - <a href="../examples/xmlrpc/introspection.tac"><span class="filename">../examples/xmlrpc/introspection.tac</span></a></div></div><p>Note the method attributes <code class="python">help</code> and
<code class="python">signature</code> which are used by the Introspection
API methods <code>system.methodHelp</code> and
<code>system.methodSignature</code> respectively. If no
<code class="python">help</code> attribute is specified,
the method's documentation string is used instead.</p><p>
We can see how introspection can be used via this interactive python session:
<pre class="python-interpreter">
&gt;&gt;&gt; import xmlrpclib
&gt;&gt;&gt; s = xmlrpclib.ServerProxy('http://127.0.0.1:8080/')
&gt;&gt;&gt; s.system.listMethods()
['add', 'echo', 'system.methodHelp', 'system.listMethods', 'system.methodSignature']
&gt;&gt;&gt; s.system.methodHelp('echo')
'Return all passed args.'
&gt;&gt;&gt; s.system.methodSignature('echo')
[['string', 'string'], ['int', 'int'], ['double', 'double'], ['array', 'array'], ['struct', 'struct']]
&gt;&gt;&gt; s.system.methodHelp('add')
'Add the arguments and return the sum.'
&gt;&gt;&gt; s.system.methodSignature('add')
[['int', 'int', 'int'], ['double', 'double', 'double']]
</pre></p><h2>SOAP Support<a name="auto4"></a></h2><p>We are not currently supporting SOAP. However, there have been Twisted SOAP
efforts made in the <a href="http://pywebsvcs.sourceforge.net/">Zolera 
SOAP Infrastructure (ZSI) project</a>.</p><h2>Creating an XML-RPC Client<a name="auto5"></a></h2><p>XML-RPC clients in Twisted are meant to look like something which will be
familiar either to <code>xmlrpclib</code> or to Perspective Broker users,
taking features from both, as appropriate. There are two major deviations
from the <code>xmlrpclib</code> way which should be noted:</p><ol><li>No implicit <code>/RPC2</code>. If the services uses this path for the
    XML-RPC calls, then it will have to be given explicitly.</li><li>No magic <code>__getattr__</code>: calls must be made by an explicit
    <code>callRemote</code>.</li></ol><p>The interface Twisted presents to XML-RPC client is that of a proxy object:
<code class="API"><a href="http://twistedmatrix.com/documents/current/api/twisted.web.xmlrpc.Proxy.html" title="twisted.web.xmlrpc.Proxy">twisted.web.xmlrpc.Proxy</a></code>. The constructor for the
object receives a URL: it must be an HTTP or HTTPS URL. When an XML-RPC service
is described, the URL to that service will be given there.</p><p>Having a proxy object, one can just call the <code>callRemote</code> method,
which accepts a method name and a variable argument list (but no named
arguments, as these are not supported by XML-RPC). It returns a deferred,
which will be called back with the result. If there is any error, at any
level, the errback will be called. The exception will be the relevant Twisted
error in the case of a problem with the underlying connection (for example,
a timeout), <code>IOError</code> containing the status and message in the case
of a non-200 status or a <code>xmlrpclib.Fault</code> in the case of an
XML-RPC level problem.</p><div class="py-listing"><pre>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web</span>.<span class="py-src-variable">xmlrpc</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">Proxy</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">internet</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">reactor</span>

<span class="py-src-keyword">def</span> <span class="py-src-identifier">printValue</span>(<span class="py-src-parameter">value</span>):
    <span class="py-src-keyword">print</span> <span class="py-src-variable">repr</span>(<span class="py-src-variable">value</span>)
    <span class="py-src-variable">reactor</span>.<span class="py-src-variable">stop</span>()

<span class="py-src-keyword">def</span> <span class="py-src-identifier">printError</span>(<span class="py-src-parameter">error</span>):
    <span class="py-src-keyword">print</span> <span class="py-src-string">'error'</span>, <span class="py-src-variable">error</span>
    <span class="py-src-variable">reactor</span>.<span class="py-src-variable">stop</span>()

<span class="py-src-variable">proxy</span> = <span class="py-src-variable">Proxy</span>(<span class="py-src-string">'http://advogato.org/XMLRPC'</span>)
<span class="py-src-variable">proxy</span>.<span class="py-src-variable">callRemote</span>(<span class="py-src-string">'test.sumprod'</span>, <span class="py-src-number">3</span>, <span class="py-src-number">5</span>).<span class="py-src-variable">addCallbacks</span>(<span class="py-src-variable">printValue</span>, <span class="py-src-variable">printError</span>)
<span class="py-src-variable">reactor</span>.<span class="py-src-variable">run</span>()
</pre><div class="caption">Source listing - <a href="../examples/xmlrpc/client.py"><span class="filename">../examples/xmlrpc/client.py</span></a></div></div><p>prints:</p><pre>
[8, 15]
</pre><h2>XML-RPC and Authentication<a name="auto6"></a></h2><p>This section is based on the 
<a href="http://twistedmatrix.com/projects/web2/documentation/howto/authentication.html">twisted.web2 
Authentication Demo</a>. Please keep in mind the caveats at the end of that
howto, as the same conditions apply here.</p><p>Listed below is a working example from the above-mentioned demo. The important
change made here is the substitution of a <code>resource.Resouce</code>
instance with an <code>xmlrpc.XMLRPC</code> instance:</p><div class="py-listing"><pre>
<span class="py-src-keyword">from</span> <span class="py-src-variable">zope</span>.<span class="py-src-variable">interface</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">Interface</span>, <span class="py-src-variable">implements</span>

<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">cred</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">portal</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">cred</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">checkers</span>

<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">channel</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">http</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">responsecode</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">server</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">xmlrpc</span>

<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span>.<span class="py-src-variable">auth</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">digest</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span>.<span class="py-src-variable">auth</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">basic</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">web2</span>.<span class="py-src-variable">auth</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">wrapper</span>

<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span>.<span class="py-src-variable">application</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">service</span>, <span class="py-src-variable">strports</span>

<span class="py-src-keyword">class</span> <span class="py-src-identifier">IHTTPUser</span>(<span class="py-src-parameter">Interface</span>):
    <span class="py-src-keyword">pass</span>

<span class="py-src-keyword">class</span> <span class="py-src-identifier">HTTPUser</span>(<span class="py-src-parameter">object</span>):
    <span class="py-src-variable">implements</span>(<span class="py-src-variable">IHTTPUser</span>)

<span class="py-src-keyword">class</span> <span class="py-src-identifier">HTTPAuthRealm</span>(<span class="py-src-parameter">object</span>):
    <span class="py-src-variable">implements</span>(<span class="py-src-variable">portal</span>.<span class="py-src-variable">IRealm</span>)

    <span class="py-src-keyword">def</span> <span class="py-src-identifier">requestAvatar</span>(<span class="py-src-parameter">self</span>, <span class="py-src-parameter">avatarId</span>, <span class="py-src-parameter">mind</span>, *<span class="py-src-parameter">interfaces</span>):
        <span class="py-src-keyword">if</span> <span class="py-src-variable">IHTTPUser</span> <span class="py-src-keyword">in</span> <span class="py-src-variable">interfaces</span>:
            <span class="py-src-keyword">return</span> <span class="py-src-variable">IHTTPUser</span>, <span class="py-src-variable">HTTPUser</span>()

        <span class="py-src-keyword">raise</span> <span class="py-src-variable">NotImplementedError</span>(<span class="py-src-string">&quot;Only IHTTPUser interface is supported&quot;</span>)

<span class="py-src-keyword">class</span> <span class="py-src-identifier">Example</span>(<span class="py-src-parameter">xmlrpc</span>.<span class="py-src-parameter">XMLRPC</span>):
    <span class="py-src-string">&quot;&quot;&quot;An example object to be published.&quot;&quot;&quot;</span>

    <span class="py-src-variable">addSlash</span> = <span class="py-src-variable">True</span>

    <span class="py-src-keyword">def</span> <span class="py-src-identifier">xmlrpc_echo</span>(<span class="py-src-parameter">self</span>, <span class="py-src-parameter">request</span>, <span class="py-src-parameter">x</span>):
        <span class="py-src-string">&quot;&quot;&quot;Return all passed args.&quot;&quot;&quot;</span>
        <span class="py-src-keyword">return</span> <span class="py-src-variable">x</span>

    <span class="py-src-keyword">def</span> <span class="py-src-identifier">xmlrpc_add</span>(<span class="py-src-parameter">self</span>, <span class="py-src-parameter">request</span>, <span class="py-src-parameter">a</span>, <span class="py-src-parameter">b</span>):
        <span class="py-src-string">&quot;&quot;&quot;Return sum of arguments.&quot;&quot;&quot;</span>
        <span class="py-src-keyword">return</span> <span class="py-src-variable">a</span> + <span class="py-src-variable">b</span>

<span class="py-src-variable">portal</span> = <span class="py-src-variable">portal</span>.<span class="py-src-variable">Portal</span>(<span class="py-src-variable">HTTPAuthRealm</span>())
<span class="py-src-variable">checker</span> = <span class="py-src-variable">checkers</span>.<span class="py-src-variable">InMemoryUsernamePasswordDatabaseDontUse</span>(<span class="py-src-variable">guest</span>=<span class="py-src-string">'guest123'</span>)
<span class="py-src-variable">portal</span>.<span class="py-src-variable">registerChecker</span>(<span class="py-src-variable">checker</span>)
<span class="py-src-variable">rsrc</span> = <span class="py-src-variable">Example</span>()
<span class="py-src-variable">credFactories</span> = (<span class="py-src-variable">basic</span>.<span class="py-src-variable">BasicCredentialFactory</span>(<span class="py-src-string">'My Realm'</span>),
    <span class="py-src-variable">digest</span>.<span class="py-src-variable">DigestCredentialFactory</span>(<span class="py-src-string">'md5'</span>, <span class="py-src-string">'My Realm'</span>))
<span class="py-src-variable">ifaces</span> = (<span class="py-src-variable">IHTTPUser</span>,)
<span class="py-src-variable">root</span> = <span class="py-src-variable">wrapper</span>.<span class="py-src-variable">HTTPAuthResource</span>(<span class="py-src-variable">rsrc</span>, <span class="py-src-variable">credFactories</span>, <span class="py-src-variable">portal</span>, <span class="py-src-variable">ifaces</span>)

<span class="py-src-variable">site</span> = <span class="py-src-variable">server</span>.<span class="py-src-variable">Site</span>(<span class="py-src-variable">root</span>)
<span class="py-src-variable">application</span> = <span class="py-src-variable">service</span>.<span class="py-src-variable">Application</span>(<span class="py-src-string">&quot;XML-RPC Auth Demo&quot;</span>)
<span class="py-src-variable">s</span> = <span class="py-src-variable">strports</span>.<span class="py-src-variable">service</span>(<span class="py-src-string">'tcp:8080'</span>, <span class="py-src-variable">channel</span>.<span class="py-src-variable">HTTPFactory</span>(<span class="py-src-variable">site</span>))
<span class="py-src-variable">s</span>.<span class="py-src-variable">setServiceParent</span>(<span class="py-src-variable">application</span>)
</pre><div class="caption">Source listing - <a href="../examples/xmlrpc/auth.tac"><span class="filename">../examples/xmlrpc/auth.tac</span></a></div></div><p>Accessing this from an interactive python session, we can see the inability
to call the RPC methods unless we have supplied the correct name and password:

<pre class="python-interpreter">
&gt;&gt;&gt; from xmlrpclib import ServerProxy
&gt;&gt;&gt; s = ServerProxy('http://localhost:8080/')
&gt;&gt;&gt; s.echo('There are some who call me... Tim?')
Traceback (most recent call last):
  [snipped]
&gt;&gt;&gt; s = ServerProxy('http://guest:guest123@localhost:8080/')
&gt;&gt;&gt; s.echo('There are some who call me... Tim?')
'There are some who call me... Tim?'
</pre></p><h2>Migrating twisted.web XML-RPC to twisted.web2<a name="auto7"></a></h2><p>Migrating your XML-RPC servers written with 
<code class="API"><a href="http://twistedmatrix.com/documents/current/api/twisted.web.xmlrpc.html" title="twisted.web.xmlrpc">twisted.web.xmlrpc</a></code> to ones
written with <code class="API"><a href="http://twistedmatrix.com/documents/current/api/twisted.web2.xmlrpc.html" title="twisted.web2.xmlrpc">twisted.web2.xmlrpc</a></code> should be fairly
trivial. There are three things you you need to do in order to migrate:

<ul><li>add <code>addSlash</code></li><li>add <code>request</code> to the <code>xmlrpc_*</code> method
signatures</li><li>wrap the <code>Site</code> instance in
<code class="API"><a href="http://twistedmatrix.com/documents/current/api/twisted.web2.channel.http.HTTPFactory.html" title="twisted.web2.channel.http.HTTPFactory">HTTPFactory</a></code></li></ul>

These are detailed below.
</p><h3>Add <code>addSlash</code><a name="auto8"></a></h3><p>Each of your <code>xmlrpc.XMLRPC</code> classes needs to set the class
attribute <code>addSlash = True</code>. All of the examples in this howto
demonstrate this.</p><h3>Add <code>request</code> to the Method Signatures<a name="auto9"></a></h3><p>When defining <code>xmlrpc_*</code> methods in
<code class="API"><a href="http://twistedmatrix.com/documents/current/api/twisted.web.xmlrpc.html" title="twisted.web.xmlrpc">twisted.web.xmlrpc</a></code>, you only needed to pass the
<code>self</code> parameter. In <code class="API"><a href="http://twistedmatrix.com/documents/current/api/twisted.web2.xmlrpc.html" title="twisted.web2.xmlrpc">twisted.web2.xmlrpc</a></code>,
you need to pass two parameters, at the very minimum: <code>self</code> and
<code>request</code>. This is also demonstrated clearly in the examples of this
howto.</p><h3>Wrap the <code>Site</code> Object<a name="auto10"></a></h3><p>In <code class="API"><a href="http://twistedmatrix.com/documents/current/api/twisted.web.xmlrpc.html" title="twisted.web.xmlrpc">twisted.web.xmlrpc</a></code>, a Site instance is passed to
<code class="API"><a href="http://twistedmatrix.com/documents/current/api/twisted.application.strports.service.html" title="twisted.application.strports.service">strports.service</a></code> or 
TCPServer (in <code class="API"><a href="http://twistedmatrix.com/documents/current/api/twisted.application.internet.html" title="twisted.application.internet">twisted.application.internet</a></code>). In
<code class="API"><a href="http://twistedmatrix.com/documents/current/api/twisted.web2.xmlrpc.html" title="twisted.web2.xmlrpc">twisted.web2.xmlrpc</a></code>, the <code>Site</code> instance
is passed to <code class="API"><a href="http://twistedmatrix.com/documents/current/api/twisted.web2.channel.http.HTTPFactory.html" title="twisted.web2.channel.http.HTTPFactory">HTTPFactory</a></code>
and then
the factory is passed in
<code class="API"><a href="http://twistedmatrix.com/documents/current/api/twisted.application.strports.service.html" title="twisted.application.strports.service">strports.service</a></code> or
internet.TCPServer. As with the previous two, the examples in this howto show
this clearly.
</p></div><p><a href="web2_oubiwann/howto/../core/documentation/howto/index.html">Index</a></p><span class="version">Version: </span></body></html>