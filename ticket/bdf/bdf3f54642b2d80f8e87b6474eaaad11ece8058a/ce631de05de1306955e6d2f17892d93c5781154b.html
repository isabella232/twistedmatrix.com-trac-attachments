<?xml version="1.0"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>Twisted Documentation: Wiki Example</title><link href="stylesheet.css" type="text/css" rel="stylesheet" /></head><body bgcolor="white"><h1 class="title">Wiki Example</h1><div class="toc"><ol><li><a href="#auto0"> What I Started With </a></li><li><a href="#auto1"> Page Py </a></li><li><a href="#auto2"> Flatfile Storage Class </a></li><li><a href="#auto3"> The Templates </a></li><li><a href="#auto4"> The RPY file. </a></li></ol></div><div class="content"><span></span><h2> What I Started With <a name="auto0"></a></h2><div class="py-listing"><pre>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span><span class="py-src-op">.</span><span class="py-src-variable">web</span><span class="py-src-op">.</span><span class="py-src-variable">resource</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">Resource</span><span class="py-src-newline">
</span><span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span><span class="py-src-op">.</span><span class="py-src-variable">web</span><span class="py-src-op">.</span><span class="py-src-variable">woven</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">page</span><span class="py-src-op">,</span> <span class="py-src-variable">widgets</span><span class="py-src-op">,</span> <span class="py-src-variable">input</span><span class="py-src-newline">
</span><span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span><span class="py-src-op">.</span><span class="py-src-variable">web</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">microdom</span><span class="py-src-newline">
</span><span class="py-src-keyword">from</span> <span class="py-src-variable">os</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">listdir</span><span class="py-src-newline">
</span><span class="py-src-keyword">import</span> <span class="py-src-variable">sre</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span><span class="py-src-nl">
</span><span class="py-src-keyword">class</span> <span class="py-src-identifier">Wiki</span><span class="py-src-op">(</span><span class="py-src-parameter">Resource</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">    </span><span class="py-src-keyword">def</span> <span class="py-src-identifier">__init__</span><span class="py-src-op">(</span><span class="py-src-parameter">self</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">        </span><span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">store</span> <span class="py-src-op">=</span> <span class="py-src-variable">Store</span><span class="py-src-op">(</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>        <span class="py-src-variable">Resource</span><span class="py-src-op">.</span><span class="py-src-variable">__init__</span><span class="py-src-op">(</span><span class="py-src-variable">self</span><span class="py-src-op">)</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span>    <span class="py-src-dedent"></span><span class="py-src-keyword">def</span> <span class="py-src-identifier">getChild</span><span class="py-src-op">(</span><span class="py-src-parameter">self</span><span class="py-src-op">,</span> <span class="py-src-parameter">name</span><span class="py-src-op">,</span> <span class="py-src-parameter">request</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">        </span><span class="py-src-keyword">return</span> <span class="py-src-variable">self</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span>    <span class="py-src-dedent"></span><span class="py-src-keyword">def</span> <span class="py-src-identifier">renderPage</span><span class="py-src-op">(</span><span class="py-src-parameter">self</span><span class="py-src-op">,</span> <span class="py-src-parameter">wikiname</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">        </span><span class="py-src-keyword">return</span> <span class="py-src-string">&quot;&quot;&quot;
&lt;html&gt;&lt;head&gt;&lt;title&gt;%s&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;%s&lt;/h1&gt;
&lt;div&gt;%s&lt;/div&gt;
&lt;a href='/%s?edit=1'&gt;Edit This&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;
&quot;&quot;&quot;</span>    <span class="py-src-op">%</span> <span class="py-src-op">(</span><span class="py-src-variable">wikiname</span><span class="py-src-op">,</span> <span class="py-src-variable">wikiname</span><span class="py-src-op">,</span> <span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">store</span><span class="py-src-op">.</span><span class="py-src-variable">getNicePage</span><span class="py-src-op">(</span><span class="py-src-variable">wikiname</span><span class="py-src-op">)</span><span class="py-src-op">,</span> <span class="py-src-variable">wikiname</span><span class="py-src-op">)</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span>    <span class="py-src-dedent"></span><span class="py-src-keyword">def</span> <span class="py-src-identifier">renderForm</span><span class="py-src-op">(</span><span class="py-src-parameter">self</span><span class="py-src-op">,</span> <span class="py-src-parameter">wikiname</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">        </span><span class="py-src-keyword">return</span> <span class="py-src-string">&quot;&quot;&quot;
&lt;html&gt;&lt;head&gt;&lt;title&gt;%s&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;%s&lt;/h1&gt;
&lt;form method=&quot;post&quot; action=&quot;/%s&quot;&gt;
&lt;textarea cols=&quot;80&quot; rows=&quot;10&quot; name=&quot;content&quot;&gt;%s&lt;/textarea&gt;
&lt;input type=&quot;submit&quot; name=&quot;save&quot; value=&quot;Save&quot;&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
&quot;&quot;&quot;</span>    <span class="py-src-op">%</span> <span class="py-src-op">(</span><span class="py-src-variable">wikiname</span><span class="py-src-op">,</span> <span class="py-src-variable">wikiname</span><span class="py-src-op">,</span> <span class="py-src-variable">wikiname</span><span class="py-src-op">,</span> <span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">store</span><span class="py-src-op">.</span><span class="py-src-variable">getPage</span><span class="py-src-op">(</span><span class="py-src-variable">wikiname</span><span class="py-src-op">)</span><span class="py-src-op">)</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span>    <span class="py-src-dedent"></span><span class="py-src-keyword">def</span> <span class="py-src-identifier">render</span><span class="py-src-op">(</span><span class="py-src-parameter">self</span><span class="py-src-op">,</span> <span class="py-src-parameter">request</span><span class="py-src-op">,</span> <span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">        </span><span class="py-src-keyword">if</span> <span class="py-src-variable">len</span><span class="py-src-op">(</span><span class="py-src-variable">request</span><span class="py-src-op">.</span><span class="py-src-variable">prepath</span><span class="py-src-op">)</span> <span class="py-src-op">==</span> <span class="py-src-number">0</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">            </span><span class="py-src-variable">wikiname</span> <span class="py-src-op">=</span> <span class="py-src-string">'MainPage'</span><span class="py-src-newline">
</span>        <span class="py-src-dedent"></span><span class="py-src-keyword">else</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">            </span><span class="py-src-variable">wikiname</span> <span class="py-src-op">=</span> <span class="py-src-variable">request</span><span class="py-src-op">.</span><span class="py-src-variable">prepath</span><span class="py-src-op">[</span><span class="py-src-number">0</span><span class="py-src-op">]</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span>        <span class="py-src-dedent"></span><span class="py-src-variable">content</span> <span class="py-src-op">=</span> <span class="py-src-variable">request</span><span class="py-src-op">.</span><span class="py-src-variable">args</span><span class="py-src-op">.</span><span class="py-src-variable">get</span><span class="py-src-op">(</span><span class="py-src-string">'content'</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>        <span class="py-src-variable">edit</span> <span class="py-src-op">=</span> <span class="py-src-variable">request</span><span class="py-src-op">.</span><span class="py-src-variable">args</span><span class="py-src-op">.</span><span class="py-src-variable">get</span><span class="py-src-op">(</span><span class="py-src-string">'edit'</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>        <span class="py-src-keyword">if</span> <span class="py-src-variable">content</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">            </span><span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">store</span><span class="py-src-op">.</span><span class="py-src-variable">setPage</span><span class="py-src-op">(</span><span class="py-src-variable">wikiname</span><span class="py-src-op">,</span> <span class="py-src-variable">content</span><span class="py-src-op">[</span><span class="py-src-number">0</span><span class="py-src-op">]</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>            <span class="py-src-variable">edit</span> <span class="py-src-op">=</span> <span class="py-src-number">0</span><span class="py-src-newline">
</span>        <span class="py-src-dedent"></span><span class="py-src-keyword">if</span> <span class="py-src-keyword">not</span> <span class="py-src-variable">edit</span> <span class="py-src-keyword">and</span> <span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">store</span><span class="py-src-op">.</span><span class="py-src-variable">hasPage</span><span class="py-src-op">(</span><span class="py-src-variable">wikiname</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">            </span><span class="py-src-keyword">return</span> <span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">renderPage</span><span class="py-src-op">(</span><span class="py-src-variable">wikiname</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>        <span class="py-src-dedent"></span><span class="py-src-keyword">return</span> <span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">renderForm</span><span class="py-src-op">(</span><span class="py-src-variable">wikiname</span><span class="py-src-op">)</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span><span class="py-src-dedent"></span><span class="py-src-dedent"></span><span class="py-src-keyword">class</span> <span class="py-src-identifier">Store</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">    </span><span class="py-src-string">&quot;&quot;&quot;
    Some silly storage class. Flatfiles in a subdirectory.
    &quot;&quot;&quot;</span>       <span class="py-src-newline">
</span><span class="py-src-nl">
</span>    <span class="py-src-variable">wikiword</span> <span class="py-src-op">=</span> <span class="py-src-variable">sre</span><span class="py-src-op">.</span><span class="py-src-variable">compile</span><span class="py-src-op">(</span><span class="py-src-string">'[A-Z][a-z]+[A-Z][a-zA-Z]*'</span><span class="py-src-op">)</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span>    <span class="py-src-keyword">def</span> <span class="py-src-identifier">__init__</span><span class="py-src-op">(</span><span class="py-src-parameter">self</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">        </span><span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">wiki</span> <span class="py-src-op">=</span> <span class="py-src-op">{</span><span class="py-src-op">}</span><span class="py-src-newline">
</span>        <span class="py-src-keyword">for</span> <span class="py-src-variable">f</span> <span class="py-src-keyword">in</span> <span class="py-src-variable">listdir</span><span class="py-src-op">(</span><span class="py-src-string">'store'</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">            </span><span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">wiki</span><span class="py-src-op">[</span><span class="py-src-variable">f</span><span class="py-src-op">]</span> <span class="py-src-op">=</span> <span class="py-src-string">''</span><span class="py-src-op">.</span><span class="py-src-variable">join</span><span class="py-src-op">(</span><span class="py-src-variable">file</span><span class="py-src-op">(</span><span class="py-src-string">&quot;store/%s&quot;</span><span class="py-src-op">%</span><span class="py-src-variable">f</span><span class="py-src-op">,</span> <span class="py-src-string">'r'</span><span class="py-src-op">)</span><span class="py-src-op">)</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span>    <span class="py-src-dedent"></span><span class="py-src-dedent"></span><span class="py-src-keyword">def</span> <span class="py-src-identifier">hasPage</span><span class="py-src-op">(</span><span class="py-src-parameter">self</span><span class="py-src-op">,</span> <span class="py-src-parameter">wikiname</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">        </span><span class="py-src-keyword">return</span> <span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">wiki</span><span class="py-src-op">.</span><span class="py-src-variable">has_key</span><span class="py-src-op">(</span><span class="py-src-variable">wikiname</span><span class="py-src-op">)</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span>    <span class="py-src-dedent"></span><span class="py-src-keyword">def</span> <span class="py-src-identifier">getPage</span><span class="py-src-op">(</span><span class="py-src-parameter">self</span><span class="py-src-op">,</span> <span class="py-src-parameter">wikiname</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">        </span><span class="py-src-keyword">try</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">            </span><span class="py-src-keyword">return</span> <span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">wiki</span><span class="py-src-op">[</span><span class="py-src-variable">wikiname</span><span class="py-src-op">]</span><span class="py-src-newline">
</span>        <span class="py-src-dedent"></span><span class="py-src-keyword">except</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">            </span><span class="py-src-keyword">return</span> <span class="py-src-string">''</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span>    <span class="py-src-dedent"></span><span class="py-src-dedent"></span><span class="py-src-keyword">def</span> <span class="py-src-identifier">getNicePage</span><span class="py-src-op">(</span><span class="py-src-parameter">self</span><span class="py-src-op">,</span> <span class="py-src-parameter">wikiname</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">        </span><span class="py-src-variable">page</span> <span class="py-src-op">=</span> <span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">getPage</span><span class="py-src-op">(</span><span class="py-src-variable">wikiname</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>        <span class="py-src-variable">matches</span> <span class="py-src-op">=</span> <span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">wikiword</span><span class="py-src-op">.</span><span class="py-src-variable">findall</span><span class="py-src-op">(</span><span class="py-src-variable">page</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>        <span class="py-src-keyword">for</span> <span class="py-src-variable">i</span> <span class="py-src-keyword">in</span> <span class="py-src-variable">dict</span><span class="py-src-op">.</span><span class="py-src-variable">fromkeys</span><span class="py-src-op">(</span><span class="py-src-variable">matches</span><span class="py-src-op">)</span><span class="py-src-op">.</span><span class="py-src-variable">keys</span><span class="py-src-op">(</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">            </span><span class="py-src-variable">page</span> <span class="py-src-op">=</span> <span class="py-src-variable">page</span><span class="py-src-op">.</span><span class="py-src-variable">replace</span><span class="py-src-op">(</span><span class="py-src-variable">i</span><span class="py-src-op">,</span> <span class="py-src-string">'&lt;a href=&quot;/%s&quot;&gt;%s&lt;/a&gt;'</span><span class="py-src-op">%</span><span class="py-src-op">(</span><span class="py-src-variable">i</span><span class="py-src-op">,</span><span class="py-src-variable">i</span><span class="py-src-op">)</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>        <span class="py-src-dedent"></span><span class="py-src-variable">page</span> <span class="py-src-op">=</span> <span class="py-src-variable">page</span><span class="py-src-op">.</span><span class="py-src-variable">replace</span><span class="py-src-op">(</span><span class="py-src-string">'\n'</span><span class="py-src-op">,</span> <span class="py-src-string">'&lt;br&gt;'</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>        <span class="py-src-keyword">return</span> <span class="py-src-variable">page</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span>    <span class="py-src-dedent"></span><span class="py-src-keyword">def</span> <span class="py-src-identifier">setPage</span><span class="py-src-op">(</span><span class="py-src-parameter">self</span><span class="py-src-op">,</span> <span class="py-src-parameter">wikiname</span><span class="py-src-op">,</span> <span class="py-src-parameter">contents</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">        </span><span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">wiki</span><span class="py-src-op">[</span><span class="py-src-variable">wikiname</span><span class="py-src-op">]</span> <span class="py-src-op">=</span> <span class="py-src-variable">contents</span><span class="py-src-newline">
</span>        <span class="py-src-variable">f</span> <span class="py-src-op">=</span> <span class="py-src-variable">file</span><span class="py-src-op">(</span><span class="py-src-string">&quot;store/%s&quot;</span><span class="py-src-op">%</span><span class="py-src-variable">wikiname</span><span class="py-src-op">,</span> <span class="py-src-string">'w'</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>        <span class="py-src-variable">f</span><span class="py-src-op">.</span><span class="py-src-variable">write</span><span class="py-src-op">(</span><span class="py-src-variable">contents</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>        <span class="py-src-variable">f</span><span class="py-src-op">.</span><span class="py-src-variable">close</span><span class="py-src-op">(</span><span class="py-src-op">)</span><span class="py-src-newline">
</span><span class="py-src-dedent"></span><span class="py-src-dedent"></span><span class="py-src-endmarker"></span></pre><div class="py-caption"> - <a href="old-mywiki.py"><span class="py-filename">old-mywiki.py</span></a></div></div><h2> Page Py <a name="auto1"></a></h2><div class="py-listing"><pre>
<span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span><span class="py-src-op">.</span><span class="py-src-variable">web</span><span class="py-src-op">.</span><span class="py-src-variable">woven</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">page</span><span class="py-src-op">,</span> <span class="py-src-variable">widgets</span><span class="py-src-newline">
</span><span class="py-src-keyword">from</span> <span class="py-src-variable">twisted</span><span class="py-src-op">.</span><span class="py-src-variable">web</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">microdom</span><span class="py-src-newline">
</span><span class="py-src-keyword">import</span> <span class="py-src-variable">store</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span><span class="py-src-keyword">class</span> <span class="py-src-identifier">Wiki</span><span class="py-src-op">(</span><span class="py-src-parameter">page</span><span class="py-src-op">.</span><span class="py-src-parameter">Page</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">    </span><span class="py-src-variable">templateFile</span> <span class="py-src-op">=</span> <span class="py-src-string">'wikipage.html'</span><span class="py-src-newline">
</span>    <span class="py-src-keyword">def</span> <span class="py-src-identifier">__init__</span><span class="py-src-op">(</span><span class="py-src-parameter">self</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">        </span><span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">store</span> <span class="py-src-op">=</span> <span class="py-src-variable">store</span><span class="py-src-op">.</span><span class="py-src-variable">Store</span><span class="py-src-op">(</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>        <span class="py-src-variable">page</span><span class="py-src-op">.</span><span class="py-src-variable">Page</span><span class="py-src-op">.</span><span class="py-src-variable">__init__</span><span class="py-src-op">(</span><span class="py-src-variable">self</span><span class="py-src-op">)</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span>    <span class="py-src-dedent"></span><span class="py-src-keyword">def</span> <span class="py-src-identifier">wmfactory_wiki</span><span class="py-src-op">(</span><span class="py-src-parameter">self</span><span class="py-src-op">,</span> <span class="py-src-parameter">request</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">        </span><span class="py-src-variable">wikiword</span> <span class="py-src-op">=</span> <span class="py-src-variable">request</span><span class="py-src-op">.</span><span class="py-src-variable">prepath</span><span class="py-src-op">[</span><span class="py-src-number">0</span><span class="py-src-op">]</span><span class="py-src-newline">
</span>        <span class="py-src-keyword">if</span> <span class="py-src-variable">request</span><span class="py-src-op">.</span><span class="py-src-variable">args</span><span class="py-src-op">.</span><span class="py-src-variable">get</span><span class="py-src-op">(</span><span class="py-src-string">'contents'</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">            </span><span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">store</span><span class="py-src-op">.</span><span class="py-src-variable">setPage</span><span class="py-src-op">(</span><span class="py-src-variable">wikiword</span><span class="py-src-op">,</span> <span class="py-src-variable">request</span><span class="py-src-op">.</span><span class="py-src-variable">args</span><span class="py-src-op">.</span><span class="py-src-variable">get</span><span class="py-src-op">(</span><span class="py-src-string">'contents'</span><span class="py-src-op">)</span><span class="py-src-op">[</span><span class="py-src-number">0</span><span class="py-src-op">]</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>        <span class="py-src-dedent"></span><span class="py-src-keyword">return</span> <span class="py-src-op">{</span><span class="py-src-nl">
</span>            <span class="py-src-string">'wikiword'</span><span class="py-src-op">:</span><span class="py-src-variable">wikiword</span><span class="py-src-op">,</span><span class="py-src-nl">
</span>            <span class="py-src-string">'editlink'</span><span class="py-src-op">:</span><span class="py-src-op">{</span><span class="py-src-string">'href'</span><span class="py-src-op">:</span><span class="py-src-string">'/%s/edit/'</span><span class="py-src-op">%</span><span class="py-src-variable">wikiword</span><span class="py-src-op">}</span><span class="py-src-op">,</span><span class="py-src-nl">
</span>            <span class="py-src-string">'contents'</span><span class="py-src-op">:</span><span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">store</span><span class="py-src-op">.</span><span class="py-src-variable">getPage</span><span class="py-src-op">(</span><span class="py-src-variable">wikiword</span><span class="py-src-op">)</span><span class="py-src-op">,</span><span class="py-src-nl">
</span>            <span class="py-src-string">'nicecontents'</span><span class="py-src-op">:</span><span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">store</span><span class="py-src-op">.</span><span class="py-src-variable">getNicePage</span><span class="py-src-op">(</span><span class="py-src-variable">wikiword</span><span class="py-src-op">)</span><span class="py-src-nl">
</span>            <span class="py-src-op">}</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span>    <span class="py-src-dedent"></span><span class="py-src-keyword">def</span> <span class="py-src-identifier">wchild_edit</span><span class="py-src-op">(</span><span class="py-src-parameter">self</span><span class="py-src-op">,</span> <span class="py-src-parameter">request</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">        </span><span class="py-src-keyword">return</span> <span class="py-src-variable">Edit</span><span class="py-src-op">(</span><span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">wmfactory_wiki</span><span class="py-src-op">(</span><span class="py-src-variable">request</span><span class="py-src-op">)</span><span class="py-src-op">)</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span>    <span class="py-src-dedent"></span><span class="py-src-keyword">def</span> <span class="py-src-identifier">getChild</span><span class="py-src-op">(</span><span class="py-src-parameter">self</span><span class="py-src-op">,</span> <span class="py-src-parameter">name</span><span class="py-src-op">,</span> <span class="py-src-parameter">request</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">        </span><span class="py-src-keyword">if</span> <span class="py-src-variable">name</span> <span class="py-src-op">==</span> <span class="py-src-string">'edit'</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">            </span><span class="py-src-keyword">return</span> <span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">wchild_edit</span><span class="py-src-op">(</span><span class="py-src-variable">request</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>        <span class="py-src-dedent"></span><span class="py-src-keyword">return</span> <span class="py-src-variable">self</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span><span class="py-src-dedent"></span><span class="py-src-dedent"></span><span class="py-src-keyword">class</span> <span class="py-src-identifier">Edit</span><span class="py-src-op">(</span><span class="py-src-parameter">page</span><span class="py-src-op">.</span><span class="py-src-parameter">Page</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">    </span><span class="py-src-variable">templateFile</span> <span class="py-src-op">=</span> <span class="py-src-string">'editpage.html'</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span>    <span class="py-src-keyword">def</span> <span class="py-src-identifier">wvfactory_form</span><span class="py-src-op">(</span><span class="py-src-parameter">self</span><span class="py-src-op">,</span> <span class="py-src-parameter">request</span><span class="py-src-op">,</span> <span class="py-src-parameter">node</span><span class="py-src-op">,</span> <span class="py-src-parameter">data</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">        </span><span class="py-src-variable">l</span> <span class="py-src-op">=</span> <span class="py-src-variable">microdom</span><span class="py-src-op">.</span><span class="py-src-variable">lmx</span><span class="py-src-op">(</span><span class="py-src-variable">node</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>        <span class="py-src-variable">l</span><span class="py-src-op">[</span><span class="py-src-string">'action'</span><span class="py-src-op">]</span> <span class="py-src-op">=</span> <span class="py-src-string">&quot;/%s/&quot;</span> <span class="py-src-op">%</span> <span class="py-src-variable">data</span><span class="py-src-op">.</span><span class="py-src-variable">getData</span><span class="py-src-op">(</span><span class="py-src-variable">request</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>        <span class="py-src-keyword">return</span> <span class="py-src-variable">node</span><span class="py-src-newline">
</span><span class="py-src-dedent"></span><span class="py-src-dedent"></span><span class="py-src-endmarker"></span></pre><div class="py-caption"> - <a href="mywiki.py"><span class="py-filename">mywiki.py</span></a></div></div><h2> Flatfile Storage Class <a name="auto2"></a></h2><div class="py-listing"><pre>
<span class="py-src-keyword">from</span> <span class="py-src-variable">os</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">listdir</span><span class="py-src-newline">
</span><span class="py-src-keyword">import</span> <span class="py-src-variable">sre</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span><span class="py-src-keyword">class</span> <span class="py-src-identifier">Store</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">    </span><span class="py-src-string">&quot;&quot;&quot;
    Some silly storage class. Flatfiles in a subdirectory.
    &quot;&quot;&quot;</span>       <span class="py-src-newline">
</span><span class="py-src-nl">
</span>    <span class="py-src-variable">wikiword</span> <span class="py-src-op">=</span> <span class="py-src-variable">sre</span><span class="py-src-op">.</span><span class="py-src-variable">compile</span><span class="py-src-op">(</span><span class="py-src-string">'[A-Z][a-z]+[A-Z][a-zA-Z]*'</span><span class="py-src-op">)</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span>    <span class="py-src-keyword">def</span> <span class="py-src-identifier">__init__</span><span class="py-src-op">(</span><span class="py-src-parameter">self</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">        </span><span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">wiki</span> <span class="py-src-op">=</span> <span class="py-src-op">{</span><span class="py-src-op">}</span><span class="py-src-newline">
</span>        <span class="py-src-keyword">for</span> <span class="py-src-variable">f</span> <span class="py-src-keyword">in</span> <span class="py-src-variable">listdir</span><span class="py-src-op">(</span><span class="py-src-string">'store'</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">            </span><span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">wiki</span><span class="py-src-op">[</span><span class="py-src-variable">f</span><span class="py-src-op">]</span> <span class="py-src-op">=</span> <span class="py-src-string">''</span><span class="py-src-op">.</span><span class="py-src-variable">join</span><span class="py-src-op">(</span><span class="py-src-variable">file</span><span class="py-src-op">(</span><span class="py-src-string">&quot;store/%s&quot;</span><span class="py-src-op">%</span><span class="py-src-variable">f</span><span class="py-src-op">,</span> <span class="py-src-string">'r'</span><span class="py-src-op">)</span><span class="py-src-op">)</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span>    <span class="py-src-dedent"></span><span class="py-src-dedent"></span><span class="py-src-keyword">def</span> <span class="py-src-identifier">hasPage</span><span class="py-src-op">(</span><span class="py-src-parameter">self</span><span class="py-src-op">,</span> <span class="py-src-parameter">wikiname</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">        </span><span class="py-src-keyword">return</span> <span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">wiki</span><span class="py-src-op">.</span><span class="py-src-variable">has_key</span><span class="py-src-op">(</span><span class="py-src-variable">wikiname</span><span class="py-src-op">)</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span>    <span class="py-src-dedent"></span><span class="py-src-keyword">def</span> <span class="py-src-identifier">getPage</span><span class="py-src-op">(</span><span class="py-src-parameter">self</span><span class="py-src-op">,</span> <span class="py-src-parameter">wikiname</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">        </span><span class="py-src-keyword">try</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">            </span><span class="py-src-keyword">return</span> <span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">wiki</span><span class="py-src-op">[</span><span class="py-src-variable">wikiname</span><span class="py-src-op">]</span><span class="py-src-newline">
</span>        <span class="py-src-dedent"></span><span class="py-src-keyword">except</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">            </span><span class="py-src-keyword">return</span> <span class="py-src-string">''</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span>    <span class="py-src-dedent"></span><span class="py-src-dedent"></span><span class="py-src-keyword">def</span> <span class="py-src-identifier">getNicePage</span><span class="py-src-op">(</span><span class="py-src-parameter">self</span><span class="py-src-op">,</span> <span class="py-src-parameter">wikiname</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">        </span><span class="py-src-keyword">if</span> <span class="py-src-keyword">not</span> <span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">hasPage</span><span class="py-src-op">(</span><span class="py-src-variable">wikiname</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">            </span><span class="py-src-keyword">return</span> <span class="py-src-string">&quot;This page does not exist yet.&quot;</span><span class="py-src-newline">
</span>        <span class="py-src-dedent"></span><span class="py-src-variable">page</span> <span class="py-src-op">=</span> <span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">getPage</span><span class="py-src-op">(</span><span class="py-src-variable">wikiname</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>        <span class="py-src-variable">matches</span> <span class="py-src-op">=</span> <span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">wikiword</span><span class="py-src-op">.</span><span class="py-src-variable">findall</span><span class="py-src-op">(</span><span class="py-src-variable">page</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>        <span class="py-src-keyword">for</span> <span class="py-src-variable">i</span> <span class="py-src-keyword">in</span> <span class="py-src-variable">dict</span><span class="py-src-op">.</span><span class="py-src-variable">fromkeys</span><span class="py-src-op">(</span><span class="py-src-variable">matches</span><span class="py-src-op">)</span><span class="py-src-op">.</span><span class="py-src-variable">keys</span><span class="py-src-op">(</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">            </span><span class="py-src-variable">page</span> <span class="py-src-op">=</span> <span class="py-src-variable">page</span><span class="py-src-op">.</span><span class="py-src-variable">replace</span><span class="py-src-op">(</span><span class="py-src-variable">i</span><span class="py-src-op">,</span> <span class="py-src-string">'&lt;a href=&quot;/%s&quot;&gt;%s&lt;/a&gt;'</span><span class="py-src-op">%</span><span class="py-src-op">(</span><span class="py-src-variable">i</span><span class="py-src-op">,</span><span class="py-src-variable">i</span><span class="py-src-op">)</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>        <span class="py-src-dedent"></span><span class="py-src-variable">page</span> <span class="py-src-op">=</span> <span class="py-src-variable">page</span><span class="py-src-op">.</span><span class="py-src-variable">replace</span><span class="py-src-op">(</span><span class="py-src-string">'\n'</span><span class="py-src-op">,</span> <span class="py-src-string">'&lt;br&gt;'</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>        <span class="py-src-keyword">return</span> <span class="py-src-variable">page</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span>    <span class="py-src-dedent"></span><span class="py-src-keyword">def</span> <span class="py-src-identifier">setPage</span><span class="py-src-op">(</span><span class="py-src-parameter">self</span><span class="py-src-op">,</span> <span class="py-src-parameter">wikiname</span><span class="py-src-op">,</span> <span class="py-src-parameter">contents</span><span class="py-src-op">)</span><span class="py-src-op">:</span><span class="py-src-newline">
</span><span class="py-src-indent">        </span><span class="py-src-variable">self</span><span class="py-src-op">.</span><span class="py-src-variable">wiki</span><span class="py-src-op">[</span><span class="py-src-variable">wikiname</span><span class="py-src-op">]</span> <span class="py-src-op">=</span> <span class="py-src-variable">contents</span><span class="py-src-newline">
</span>        <span class="py-src-variable">f</span> <span class="py-src-op">=</span> <span class="py-src-variable">file</span><span class="py-src-op">(</span><span class="py-src-string">&quot;store/%s&quot;</span><span class="py-src-op">%</span><span class="py-src-variable">wikiname</span><span class="py-src-op">,</span> <span class="py-src-string">'w'</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>        <span class="py-src-variable">f</span><span class="py-src-op">.</span><span class="py-src-variable">write</span><span class="py-src-op">(</span><span class="py-src-variable">contents</span><span class="py-src-op">)</span><span class="py-src-newline">
</span>        <span class="py-src-variable">f</span><span class="py-src-op">.</span><span class="py-src-variable">close</span><span class="py-src-op">(</span><span class="py-src-op">)</span><span class="py-src-newline">
</span><span class="py-src-dedent"></span><span class="py-src-dedent"></span><span class="py-src-endmarker"></span></pre><div class="py-caption"> - <a href="store.py"><span class="py-filename">store.py</span></a></div></div><h2> The Templates <a name="auto3"></a></h2><div class="py-listing"><pre class="htmlsource">
&lt;html&gt;&lt;head&gt;&lt;title model=&quot;/wikiword&quot; /&gt;&lt;/head&gt;
&lt;body&gt;
&lt;h1 model=&quot;/wikiword&quot;&gt;&lt;/h1&gt;
&lt;form method=&quot;post&quot; model=&quot;/wikiword&quot; view=&quot;form&quot;&gt;
&lt;textarea cols=&quot;80&quot; rows=&quot;10&quot; name=&quot;contents&quot; model=&quot;/contents&quot; /&gt;
&lt;br /&gt;
&lt;input type=&quot;submit&quot; name=&quot;save&quot; value=&quot;Save&quot; /&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre><div class="py-caption"> - <a href="editpage.xhtml"><span class="py-filename">editpage.html</span></a></div></div><div class="py-listing"><pre class="htmlsource">
&lt;html&gt;&lt;head&gt;&lt;title model=&quot;/wiki/wikiword&quot; /&gt;&lt;/head&gt;
&lt;body&gt;
&lt;h1 model=&quot;/wiki/wikiword&quot;&gt;&lt;/h1&gt;
&lt;div&gt;&lt;span model=&quot;/wiki/nicecontents&quot; view=&quot;RawText&quot; /&gt;&lt;/div&gt;
&lt;a view=&quot;Attributes&quot; model=&quot;/wiki/editlink&quot;&gt;Edit This&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre><div class="py-caption"> - <a href="wikipage.xhtml"><span class="py-filename">wikipage.html</span></a></div></div><h2> The RPY file. <a name="auto4"></a></h2><div class="py-listing"><pre>
<span class="py-src-keyword">import</span> <span class="py-src-variable">mywiki</span><span class="py-src-newline">
</span><span class="py-src-nl">
</span><span class="py-src-variable">reload</span><span class="py-src-op">(</span><span class="py-src-variable">mywiki</span><span class="py-src-op">)</span><span class="py-src-newline">
</span><span class="py-src-variable">resource</span> <span class="py-src-op">=</span> <span class="py-src-variable">mywiki</span><span class="py-src-op">.</span><span class="py-src-variable">Wiki</span><span class="py-src-op">(</span><span class="py-src-op">)</span><span class="py-src-newline">
</span><span class="py-src-endmarker"></span></pre><div class="py-caption"> - <a href="wiki.rpy"><span class="py-filename">wiki.rpy</span></a></div></div></div><p><a href="index.xhtml">Index</a></p></body></html>